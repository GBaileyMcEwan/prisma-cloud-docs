== Configure code repository scanning

Prisma Cloud can scan GitHub repositories and identify vulnerabilities in your software's dependencies.
Modern apps are increasingly composed of external, open source dependencies, so it's important to give developers tools to assess those components early in the development lifecycle.
Repository scanning gives you early insight into the software as it's being developed, and long before apps are packaged (e.g. as a container) and deployed by CI/CD pipelines.

Currently, Prisma Cloud supports Python, Java, and JavaScript (Node.js).


=== Prerequisites

Prisma Cloud authenticates with the GitHub API using user-generated API tokens.
The following scopes are required:

* repo -- Full control of private repositories
** repo:status -- Access commit status
** repo_deployment -- Access deployment status
** public_repo -- Access public repositories
** repo:invite -- Access repository invitations
** security_events -- Read and write security events


=== Deployment

Prisma Cloud selects the repositories to scan according to a user-defined _scope_.
For example, you might want to scan all repositories in your organization or just a subset of them.
For each repo in scope, Prisma Cloud searches for well-known package manifest files, and enumerates the dependencies listed in them.
Those dependencies are assessed against the latest threat data in the Intelligence Stream.

Code repository scans is handled by Console.

The following table lists the manifest files known to the scanner.
When setting up your scanning scope, you can specify other manifest files that the scanner should parse.

[cols="1,1", options="header"]
|===
|Package manager
|File name

|Java (Gradle)
|build.gradle

|Java (Maven)
|pom.xml

|Python (pip)
|req{asterisk}.txt

|JavaScript (NPM)
|package.json, package-lock.json
|===

When package manifests don't explicitly specify a package version, Prisma Cloud reports vulnerabilities for the latest version available in the package repository.
For Python, Prisma Cloud assesses the latest stable version, not just the latest version, which can sometimes be a pre-release.

Finally, Prisma Cloud can continuously monitor your code repositories for vulnerabilities by rescanning on every push event.
Prisma Cloud integrates with GitHub using webooks, which notify the scanner when there are changes in the repository.

NOTE: Prisma Cloud uses the GitHub API
The GitHub API is https://developer.github.com/v3/#rate-limiting[rate-limited]. 
For unauthenticated requests, which can be used to scan public repositories, the cap is very low (60 requests/hour).
For authenticated requests, which can scan either public or private repositories, the cap is 5000 requests/hour.


[.task]
=== Set up your credentials

Generate a personal access token in GitHub, and then save it in the Prisma Cloud Credentials Store so that the scanner can access your repositories for scanning.

[.procedure]

. Generate a GitHub access token.

.. Log into your GitHub account.

.. Go to *Settings > Developer Settings > Personal access tokens*.

.. Click *Generate new token*.

.. Set the scope to *repo*.
+
image::code_repo_scanning_creds.png[width=700]

.. Click *Generate token*.
If your account requires SSO, enable it.

.. Copy the generated token.
+
image::code_repo_scanning_token.png[width=550]

. Save the token in Prisma Cloud's credentials store.

.. Log into Prisma Cloud Console.

.. Go to *Manage > Authentication > Credentials Store*.

.. Click *Add Credential*.

.. Enter a *Name* for the credential.

.. In *Type*, select GitHub access token.

.. In *Access Token*, paste the access token you generated in GitHub.

.. Click *Save*.


[.task]
=== Configure the repos to scan

Specify the repositorires to scan.
If your repository specifies dependencies in non-standard package manifest files, specify them here so the scanner can parse them.
If there are manifests the scanner should ignore, specify them here as well.

[.procedure]
. Open Console.

. Go to *Defend > Vulnerabilities > Code Repositories*.

. Click *Add Scope*.
If this is your first repository, click *Add the first item*.
+
Each scope spec has the following parameters:
+
[cols="20%,80%a", options="header"]
|===
|Field
|Description

|Provider
|GitHub is currently the only supported provider.

|Type
|To scan all repos in an organization, including both public and private repos, set the type to *Public & Private*.
You'll need to set up an access token, so that Prisma Cloud can access your repos.

To scan public repositories, set the type to *Public*.
When type is *Public*, credentials are not required, although API accesss to GitHub is capped to a very low value.
Even if you're only scanning public repos, we recommend that you set up an access token for authenticated access.

|Credential
|Specify credentials for the repository owner.
If the credentials have already been created in the Prisma Cloud credentials store, select it.
If not, click *Add New*.

|Repositories
|Specify the repositories to scan in the format: owner/name
When you've selected a credential, the drop-down lists all repositories in the owner's account.
Expressions with wildcards aren't supported in this field (e.g. owner/d*).
A single wildcard, which specifies all repos in an owner's account, is valid.

|Excluded manifest paths
|Specify paths to be excluded for analysis.

|Advanced settings > Explicit manifest names
|Specify additional file names that should be included for analysis.
If you have a custom naming scheme for your manifest files, specify them here so that the scanner can find and parse them.

|Advanced settings > Python version
|For a more accurate analysis of your app's dependencies, specify the version of Python you deploy in production.
Otherwise, the scanner assumes the latest available version of Python.

|===

. Click *Add*.

. Click *Save*.


[.task]
=== Scan repos on push events

Configure GitHub webhooks to rescan your repositories on push events.

[.procedure]
. Open Console.

. Go to *Defend > Vulnerabilities > Code Repositories*.

. In *Webhook settings*, select the publicly accessible name or IP address GitHub will use to notify Prisma Cloud that a push event occurred.

. Copy the URL.

. Configure GitHub.

.. Log into GitHub, and go to *Settings > Webhooks*.

.. Click *Add webhook*.

.. In *Payload URL*, paste the URL you copied from Prisma Cloud Console.

.. Select *Disable SSL verification*.
+
For Prisma Cloud Enterprise Edition, select *Enable SSL verification*.

.. Leave all other settings in their default state.

.. Click *Add webhook*.

.. Verify that the ping webhook was delivered successfully.


=== Policy

Prisma Cloud ships with a default rule that alerts on vulnerabilities.
In *Defend > Vulnerabilities > Code Repositories*, create vulnerability rules to tailor what's reported.

Additional scan settings can be found under *Manage > System > Scan*, where you can set the xref:../configure/configure_scan_intervals.adoc#[scan interval].
By default, it's 24 hours.
